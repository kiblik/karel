unit ulang;

interface
uses UUtils;
var _lMsgKarel_NoPic: string='Nenasiel som obr·zok Karla! Karel nebude zobrazen˝!';
    _lMsgCloseAppl : string ='Projekt bol zmenen˝ a nie je uloûen˝. M·m napriek tomu program ukonËiù?';
    _lMsgErrorUnknownCmd : string = 'Nepozn·m prÌkaz ';
    _lMsgErrorOpakuj : string = 'Chybn· ötrukt˙ra prÌkazu opakuj';
    _lMsgErrorOpakujCislo : string = 'za slovom opakuj by malo nasledovat cislo';
    _lMsgErrorOpakujKrat : string ='chyba slovo krat v strukture prikazu opakuj';
    _lMsgErrorOpakujEnd : string ='chybna struktura prikazu opakuj - nenasiel som ukoncenie';
    _lMsgErrorKym : string ='chybna struktura prikazu kym';
    _lMsgErrorKymJe : string = 'za slovom kym musi nasledovat "je" alebo "nie je"';
    _lMsgErrorKymJezanie : string = 'za slovom nie musi nasledovat "je"';
    _lMsgErrorKymRob : string ='ocakaval som slovo rob';
    _lMsgErrorKymEnd : string ='chybna struktura prikazu kym - nenasiel som ukoncenie';
    _lMsgErrorAk : string ='chybna struktura prikazu ak';
    _lMsgErrorAkJe : string = 'za slovom ak musi nasledovat "je" alebo "nie je"';
    _lMsgErrorAkJezanie : string = 'za slovom nie musi nasledovat "je"';
    _lMsgErrorAkTak : string = 'ocakaval som slovo tak';
    _lMsgErrorPresun : string ='Za prikazom presun ocakavam dve cisla';
    _lMsgErrorPrikaz : string ='Chybna struktura prikazu ';
    _lPrikazEndCmd : string = '*prikaz';
    _lInakCmd : string = 'inak';
    _lAkEndCmd : string = '*ak';
    _lTakCmd : string = 'tak';
    _lKymEndCmd : string ='*kym';
    _lRobCmd : string = 'rob';
    _lJeCmd : string = 'je';
    _lNieCmd : string = 'nie';
    _lKratCmd : string = 'krat';
    _lKrokCmd : string = 'krok';
    _lPolozCmd : string = 'poloz';
    _lZoberCmd : string = 'zober';
    _lVlavoCmd : string = 'vlavo';
    _lZmazCmd : string = 'zmaz';
    _lOpakujCmd : string = 'opakuj';
    _lOpakujEndCmd : string = '*opakuj';
    _lPresunCmd : string = 'presun';
    _lKymCmd : string = 'kym';
    _lStojCmd : string = 'stoj';
    _lPomalyCmd : string = 'pomaly';
    _lRychloCmd : string = 'rychlo';
    _lAkCmd : string = 'ak';
    _lTehlaCmd : string = 'tehla';
    _lStenaCmd : string = 'stena';
    _lNahodaCmd : string = 'nahoda';
    _lPrikazCmd : string = 'prikaz';
    _lVolnoCmd : string = 'volno';
    _lMsgErrorUnknownCnd : string= 'Nepozn·m podmienku ';
    _lMsgSaveTitle : string='Uloûenie projektu';
    _lMsgSaveError : string='Chyba pri ukladanÌ s˙boru.';
    _lMsgOpenError : string ='Chybny form·t s˙boru.';
    _lMsgNoSavedWarn : string = 'Aktualny projekt bude vymazany. Mam pokracovat?';
    _lMsgNoSavedTitle : string='Neulozeny projekt';
    _lMsgOpenTitle : string = 'Otvorenie projektu.';
    _lMsgReadingError : string ='Problem s otvorenim suboru';
    _lMenuSubor : string ='Ukladanie projektu';
    _lMenuNovyProjekt : string = 'Nov˝ projekt';
    _lMenuOtvoritProjekt : string = 'Otvoriù projekt';
    _lMenuUlozitProjekt : string = 'Uloûiù projekt';
    _lMenuNastavenia : string = 'Nastavenia vzhæadu';
    _lMenuRozmeryMiestnosti : string = 'Rozmery miestnosti';
    _lMenuPosunMiestnosti : string = 'Posun miestnosti';
    _lMenuObmedzenieKarla : string = 'Obmedzenia Karla';
    _lMenuLupa : string = 'Zv‰Ëöenie/zmenöenie';
    _lMenuSlovnik : string = 'PrÌkazy Karla';
    _lMenuMIKoniec : string = 'UkonËenie programu';
    _lTBNew : string = 'Nov˝ projekt';
    _lTBOpen : string = 'Otvoriù projekt';
    _lTBSave : string = 'Uloûiù projekt';
    _lTBResize : string = 'Zmeniù rozmery miestnosti';
    _lTBMove : string = 'Posun˙ù miestnosù';
    _lTBKarelLimit : string = 'Nastaviù rÙzne obmedzenia Karla';
    _lTBCommands : string = 'Otvoriù slovnÌk s prÌkazmi Karla';
    _lBNewCaption : string = 'Novy'#13'prikaz';
    _lBDeleteCaption : string ='Zmaz'#13'prikaz';
    _lBRenameCaption : string ='Premenuj'#13'prikaz';
    _lNovyPrikaz : string = 'Novy prikaz';
    _lMsgZadajMeno : string = 'Zadaj meno noveho prikazu';
    _lMsgErrorRezSlovo1 : string =' nemozes pouzit ako meno prikazu. ';
    _lMsgErrorRezSlovo2 : string =' je zakladny prikaz alebo je jeho sucastou.';
    _lMsgErrorJednoSlovo : string ='Meno prikazu musi byt jedno slovo (bez medzier)';
    _lZmazatPrikaz : string = 'Mam zmazat prikaz';
    _lPremenovaniePrikazu : string = 'Premenovanie prikazu ';
    _lZadajMeno : string ='Zadaj nove meno prikazu:';
    _MsgErrorRovnakeMeno : string = 'Povodne a nove meno su rovnake.';
    _MsgErrorUzExistuje : string = 'Nemozem zmenit meno na meno uz existujuceho prikazu';
    _lRozmeryCaption : string = 'Nastavenie rozmerov miestnosti';
    _lRozmeryLBCaption : string = 'Rozmery miestnosti';
    _lRozmeryVyska : string ='Vyska';
    _lRozmerySirka : string ='Sirka';
    _lRozmeryDlzka : string ='Dlzka';
    _lButtonNastav : string = 'Nastav';
    _lButtonNenastav : string = 'Nenastav';
    _lMoveCaption : string = 'Klikaj na sipky';
    _lBStopCaption : string = 'zastavenie'#13#10'programu';
    _lLimitsCaption : string ='Obmedzenie Karla';
    _lLimitsVykrocit : string ='Pocet tehal, na ktore vie Karel vykrocit';
    _lLimitsSpomalit : string ='Spomalenie Karla';
    _lZoomCaption : string ='Klikni na sipky na krajoch posuvnika';
    _lMsgErrorPresun2 : string = 'Nespravne suradnice za prikazom presun';
    _lMsgStop : string ='program zastaveny';
    _lMsgErrorKrok : string ='Karel nema volno, nemoze urobit krok.';
    _lMsgErrorPolozPriStene : string = 'Karel stoji pred stenou, nema kam polozit tehlu.';
    _lMsgErrorPolozVyska : string = 'Karel nemoze polozit tehlu vyssie ako je vyska miestnosti.';
    _lMsgErrorZoberNietco : string ='Pred Karlom nie je ziadna tehla na zobratie.';
    _lOznacCmd : string ='oznac';
    _lOdznacCmd : string ='odznac';
    _lZnackaCmd : string ='znacka';
    _lPodmienkaCmd : string ='podmienka';
    _lErrorMsgPrikazZly : string ='Nespravny format prikazu';
    _lVysledokCnd : string = 'vysledok';
    _lMsgErrorCnd : string = 'Problem so spracovanim podmienky';
    _lPodmienkaEndCmd : string = '*podmienka';
    _lResultCmd : string ='vysledok';
    _lPravdaCmd : string ='pravda';
    _lNepravdaCmd : string ='nepravda';
    _lYesButton : string ='¡n&o';
    _lNoButton : string ='&Nie';
    _lCancelButton : string ='&Zruöiù';
    _lMsgUkoncenieProgramu : string ='UkonËenie programu';
    _lMsgRunError : string ='Chyba pri spusteni programu.';
    _lErrorMsgRuntime : string ='Chyba v programe';
    _lMsgUkladanie : string ='Ukladanie projektu';
    _lMsgNacitanie : string ='Nacitanie projektu';
    _lMsgNeulozeny : string ='Neulozeny projekt';

function GetOpakuj(var Cmd : string; var OK : Boolean) : TOpakuj;
function GetPresun(var Cmd : string; var OK : Boolean) : TPresun;
function GetKym(var Cmd : string; var OK : Boolean) : TKym;
function GetAk(var Cmd : string; var OK : Boolean) : TAk;
function GetPrikaz(CmdName : string; Lines : array of string; var OK : Boolean) : string;
function GetCond(Cond : array of string;var OK : Boolean) :TCond;

implementation
uses SysUtils;

function GetCond(Cond : array of string;var OK : Boolean) :TCond;
var S : string;
    I : Integer;
begin
  Result.Cmds:='';
  S:='';
  OK:=False;
  for I:=0 to Length(Cond)-1 do S:=S+' '+Cond[I];
  UnSpace(S);
  if LowerCase(First(S))<>'podmienka' then
    begin
      ErrorMsg:='Chybna struktura podmienky';
      Exit
    end;
  First(S);
  if Last(S)<>'*podmienka' then
    begin
      ErrorMsg:='Chybna struktura podmienky';
      Exit
    end;
  OK:=True;
  Result.Cmds:=S
end;

function GetOpakuj(var Cmd : string; var OK : Boolean) : TOpakuj;
var Iter,Pom : Integer;
    S : string;
begin
  Iter:=1;
  OK:=False;
  Result.Pocet:=0;
  Result.Commands:='';
  if Cmd='' then
    begin
      ErrorMsg:=_lMsgErrorOpakuj;
      Exit;
    end;
  {cislo}
  S:=First(Cmd);
  Val(S,Result.Pocet,Pom);
  if Pom>0 then
    begin
      ErrorMsg:=_lMsgErrorOpakujCislo;
      Exit
    end;
  S:=First(Cmd);
  if LowerCase(S)<>_lKratCmd then
    begin
      ErrorMsg:=_lMsgErrorOpakujKrat;
      Exit
    end;
  S:=First(Cmd);
  while  (Iter>0) and ((S<>'') or (Cmd<>'')) do
    begin
      if LowerCase(S)=_lOpakujCmd then Inc(Iter);
      if LowerCase(S)=_lOpakujEndCmd then Dec(Iter);
      if Iter>0 then
        begin
          Result.Commands:=Result.Commands+S+' ';
          S:=First(Cmd);
        end;
    end;
  if Iter>0 then
    begin
      ErrorMsg:=_lMsgErrorOpakujEnd;
      Exit;
    end;
  OK:=True;
  ErrorMsg:='';
end;

function GetKym(var Cmd : string; var OK : Boolean) : TKym;
var Iter : Integer;
    S : string;
begin
  Iter:=1;
  OK:=False;
  Result.Je:=True;
  Result.Cond:='';
  Result.Commands:='';
  if Cmd='' then
    begin
      ErrorMsg:=_lMsgErrorKym;
      Exit;
    end;
  {cislo}
  S:=LowerCase(First(Cmd));
  if (S<>_lJeCmd)and(S<>_lNieCmd) then
    begin
      ErrorMsg:=_lMsgErrorKymJe;
      Exit
    end;
  Result.Je:=True;
  if S=_lNieCmd then
    begin
      S:=LowerCase(First(Cmd));
      if S<>_lJeCmd then
        begin
          ErrorMsg:=_lMsgErrorKymJezanie;
          Exit
        end;
      Result.Je:=False;
    end;
  S:=LowerCase(First(Cmd));
  if BasicCnds.IndexOf(S)=-1 then S:='%'+S;
  Result.Cond:=S;
  S:=LowerCase(First(Cmd));
  if S<>_lRobCmd then
    begin
      ErrorMsg:=_lMsgErrorKymRob;
      Exit
    end;
  S:=First(Cmd);
  Result.Commands:='';
  while  (Iter>0) and ((S<>'') or (Cmd<>'')) do
    begin
      if LowerCase(S)=_lKymCmd then Inc(Iter);
      if LowerCase(S)=_lKymEndCmd then Dec(Iter);
      if Iter>0 then
        begin
          Result.Commands:=Result.Commands+S+' ';
          S:=First(Cmd);
        end;
    end;
  if Iter>0 then
    begin
      ErrorMsg:=_lMsgErrorKymEnd;
      Exit;
    end;
  OK:=True;
  ErrorMsg:='';
end;

function GetAk(var Cmd : string; var OK : Boolean) : TAk;
var Iter : Integer;
    S : string;
begin
  Iter:=1;
  OK:=False;
  Result.Je:=True;
  Result.Cond:='';
  Result.TrueCmd:='';
  Result.FalseCmd:='';
  if Cmd='' then
    begin
      ErrorMsg:=_lMsgErrorKym;
      Exit;
    end;
  {cislo}
  S:=LowerCase(First(Cmd));
  if (S<>_lJeCmd)and(S<>_lNieCmd) then
    begin
      ErrorMsg:=_lMsgErrorAkJe;
      Exit
    end;
  Result.Je:=True;
  if S=_lNieCmd then
    begin
      S:=LowerCase(First(Cmd));
      if S<>_lJeCmd then
        begin
          ErrorMsg:=_lMsgErrorAkJezanie;
          Exit
        end;
      Result.Je:=False;
    end;
  S:=LowerCase(First(Cmd));
  Result.Cond:=S;
  S:=LowerCase(First(Cmd));
  if S<>_lTakCmd then
    begin
      ErrorMsg:=_lMsgErrorAkTak;
      Exit
    end;
  S:=First(Cmd);
  while  (Iter>0) and ((S<>'') or (Cmd<>'')) do
    begin
      if LowerCase(S)=_lAkCmd then Inc(Iter);
      if (Iter=1)and(LowerCase(S)=_lInakCmd) then Dec(Iter);
      if LowerCase(S)=_lAkEndCmd then Dec(Iter);
      if Iter>0 then
        begin
          Result.TrueCmd:=Result.TrueCmd+S+' ';
          S:=First(Cmd);
        end;
    end;
  if Iter>0 then
    begin
      ErrorMsg:=_lMsgErrorAk;
      Exit;
    end;
  if LowerCase(S)=_lInakCmd then
    begin
      S:=First(Cmd);
      Iter:=1;
      while  (Iter>0) and ((S<>'') or (Cmd<>'')) do
        begin
          if LowerCase(S)=_lAkCmd then Inc(Iter);
          if LowerCase(S)=_lAkEndCmd then Dec(Iter);
          if Iter>0 then
            begin
              Result.FalseCmd:=Result.FalseCmd+S+' ';
              S:=First(Cmd);
            end;
        end;
      if Iter>0 then
        begin
          ErrorMsg:=_lMsgErrorAk;
          Exit;
        end;
    end;
  OK:=True;
  ErrorMsg:='';
end;

function GetPresun(var Cmd : string; var OK : Boolean) : TPresun;
var Pom : Integer;
      S : string;
begin
  OK:=False;
  ErrorMsg:=_lMsgErrorPresun;
  S:=First(Cmd);
  Val(S,Result.NX,Pom);
  if Pom <>0 then Exit;
  S:=First(Cmd);
  Val(S,Result.NY,Pom);
  if Pom<>0 then Exit;
  ErrorMsg:='';
  OK:=True;
end;

function GetPrikaz(CmdName : string; Lines : array of string; var OK : Boolean) : string;
var I : Integer;
    S,C : string;
begin
  OK:=False;
  for I:=0 to Length(Lines)-1 do S:=S+Lines[I]+' ';
  UnSpace(S);
  Result:='';
  C:=First(S);
  if (C<>_lPrikazCmd) and (C<>_lPodmienkaCmd) or(S='') then
    begin
      ErrorMsg:=_lMsgErrorPrikaz+CmdName;
      Exit
    end;
  C:=First(S);
  if (S='') then
    begin
      ErrorMsg:=_lMsgErrorPrikaz+CmdName;
      Exit
    end;
  C:=Last(S);
  if (C<>_lPrikazEndCmd) and (C<>_lPodmienkaEndCmd) then
    begin
      ErrorMsg:=_lMsgErrorPrikaz+CmdName;
      Exit
    end;
  Result:=S;
  OK:=True;
  {este treba odrezat koniec prikazu *prikaz}
end;


end.
